{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n/**\n * Servicio de autenticación\n * Maneja login básico y utilidades de autenticación\n * Compatible con WebView de Windows 10/11 para MDM enrollment\n */\nvar AuthService = /*#__PURE__*/function () {\n  function AuthService() {\n    _classCallCheck(this, AuthService);\n  } // Inicialización si es necesaria\n\n  /**\n   * Login básico (usuario/contraseña)\n   * Compatible con dominios federados - redirige a login federado si es necesario\n   * Nota: En producción, esto debería usar un backend seguro\n   */\n  return _createClass(AuthService, [{\n    key: \"basicLogin\",\n    value: (function () {\n      var _basicLogin = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(username, password) {\n        var domain, response, mockToken, data, _t;\n        return _regeneratorRuntime.wrap(function (_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              // Verificar si es un dominio federado\n              domain = username.split('@')[1];\n              if (domain && this.isFederatedDomain(domain)) {\n                // Para dominios federados, normalmente se redirige al proveedor de identidad\n                // En un escenario real, esto se manejaría en el backend\n                console.log('Dominio federado detectado:', domain);\n              }\n\n              // En producción, esto debe hacerse en el backend\n              // Aquí simulamos la autenticación básica\n              // Para desarrollo, aceptamos cualquier credencial\n              _context.next = 1;\n              return fetch('/api/auth/basic', {\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                  username: username,\n                  password: password\n                })\n              });\n            case 1:\n              response = _context.sent;\n              if (!(!response || response.status === 404)) {\n                _context.next = 2;\n                break;\n              }\n              // Simulación para desarrollo - en producción esto debe validarse en el backend\n              mockToken = 'mock_token_' + Date.now();\n              sessionStorage.setItem('authToken', mockToken);\n              sessionStorage.setItem('username', username);\n              sessionStorage.setItem('loginTime', new Date().toISOString());\n              return _context.abrupt(\"return\", {\n                success: true,\n                data: {\n                  token: mockToken,\n                  username: username\n                }\n              });\n            case 2:\n              if (response.ok) {\n                _context.next = 3;\n                break;\n              }\n              throw new Error('Credenciales inválidas');\n            case 3:\n              _context.next = 4;\n              return response.json();\n            case 4:\n              data = _context.sent;\n              // Guardar token en sessionStorage (compatible con WebView)\n              sessionStorage.setItem('authToken', data.token);\n              sessionStorage.setItem('username', username);\n              sessionStorage.setItem('loginTime', new Date().toISOString());\n              return _context.abrupt(\"return\", {\n                success: true,\n                data: data\n              });\n            case 5:\n              _context.prev = 5;\n              _t = _context[\"catch\"](0);\n              console.error('Error en login básico:', _t);\n              return _context.abrupt(\"return\", {\n                success: false,\n                error: _t.message || 'Error al iniciar sesión'\n              });\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this, [[0, 5]]);\n      }));\n      function basicLogin(_x, _x2) {\n        return _basicLogin.apply(this, arguments);\n      }\n      return basicLogin;\n    }()\n    /**\n     * Verificar si un dominio es federado\n     * En producción, esto debería consultarse desde el backend\n     */\n    )\n  }, {\n    key: \"isFederatedDomain\",\n    value: function isFederatedDomain(domain) {\n      if (!domain) return false;\n      var lowerDomain = domain.toLowerCase();\n      // Lista de dominios federados comunes (ejemplo)\n      var federatedDomains = ['outlook.com', 'hotmail.com', 'live.com', 'msn.com'];\n      return federatedDomains.includes(lowerDomain);\n    }\n\n    /**\n     * Verificar si el usuario está autenticado\n     */\n  }, {\n    key: \"isBasicAuthenticated\",\n    value: function isBasicAuthenticated() {\n      return !!sessionStorage.getItem('authToken');\n    }\n\n    /**\n     * Obtener cuenta activa del usuario autenticado\n     */\n  }, {\n    key: \"getBasicAccount\",\n    value: function getBasicAccount() {\n      var username = sessionStorage.getItem('username');\n      var token = sessionStorage.getItem('authToken');\n      if (username && token) {\n        return {\n          username: username,\n          token: token\n        };\n      }\n      return null;\n    }\n\n    /**\n     * Cerrar sesión del usuario\n     */\n  }, {\n    key: \"logoutBasic\",\n    value: function logoutBasic() {\n      sessionStorage.removeItem('authToken');\n      sessionStorage.removeItem('username');\n      sessionStorage.removeItem('loginTime');\n      return {\n        success: true\n      };\n    }\n\n    /**\n     * Verificar si estamos en WebView de Windows\n     * Detecta WebView2 (Edge Chromium) y WebView antiguo (EdgeHTML)\n     */\n  }, {\n    key: \"isWindowsWebView\",\n    value: function isWindowsWebView() {\n      if (typeof navigator === 'undefined') {\n        return false;\n      }\n      var userAgent = navigator.userAgent || navigator.vendor || window.opera || '';\n      var isWindows = /Windows|Win32|Win64/.test(userAgent);\n\n      // WebView2 tiene un user agent específico\n      var isWebView2 = /Edg\\/|EdgA\\/|EdgiOS\\//.test(userAgent) && !/Chrome/.test(userAgent.replace(/Edg.*?/, ''));\n\n      // WebView antiguo (EdgeHTML) - típicamente usado en Windows 10\n      var isEdgeHTML = /Edge\\/\\d+/.test(userAgent) && !/Chrome/.test(userAgent);\n\n      // También puede detectarse por la ausencia de navegadores conocidos en Windows\n      var isWindowsWithoutBrowser = isWindows && !/Chrome|Firefox|Safari|Opera/.test(userAgent) && !isWebView2 && !isEdgeHTML;\n      return isWebView2 || isEdgeHTML || isWindowsWithoutBrowser;\n    }\n  }]);\n}(); // Exportar instancia singleton\nexport var authService = new AuthService();\nexport default authService;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}